<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Weather Prediction</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* üåå ÿÆŸÑŸÅŸäÿ© ÿπÿßŸÖÿ© ÿ®ŸÜŸÖÿ∑ ŸáÿßÿØÿ¶ */
    body {
      margin: 0;
      font-family: "Cairo", sans-serif;
      background: linear-gradient(135deg, #e0f7ff, #a0d4f7);
      color: #004466;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-y: auto;
    }

    /* ‚ú® ÿßŸÑÿπŸÜŸàÿßŸÜ */
    h1 {
      margin: 25px 0;
      font-size: 2.8rem;
      color: #0077aa;
      text-shadow: 0 0 10px #00aaff, 0 0 20px #0099cc;
      font-weight: bold;
      letter-spacing: 2px;
    }

    /* üì¶ ÿßŸÑÿ≠ÿßŸàŸäÿ© */
    .container {
      width: 95%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.8);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0, 119, 170, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 119, 170, 0.3);
      margin-bottom: 30px;
    }

    /* üß≠ ÿπŸÜÿßÿµÿ± ÿßŸÑÿ™ÿ≠ŸÉŸÖ */
    .controls {
      text-align: center;
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(0, 119, 170, 0.3);
      border-radius: 16px;
      padding: 15px;
      box-shadow: 0 0 15px rgba(0, 119, 170, 0.1);
    }

    /* üß© ÿßŸÑŸÇŸàÿßÿ¶ŸÖ ŸàÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */
    select, input[type="number"], input[type="range"], button {
      background: rgba(240, 248, 255, 0.9);
      border: 2px solid #0077aa;
      color: #004466;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 1rem;
      margin: 10px;
      outline: none;
      cursor: pointer;
      transition: 0.3s ease;
    }

    select:hover, input[type="number"]:hover, input[type="range"]:hover, button:hover {
      background: #0077aa;
      color: #ffffff;
      box-shadow: 0 0 10px #0077aa, 0 0 20px #00aaff;
    }

    /* üåç ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© */
    #map {
      height: 450px;
      width: 100%;
      border-radius: 16px;
      margin: 25px 0;
      box-shadow: 0 0 25px rgba(0, 119, 170, 0.4);
      border: 1px solid rgba(0, 119, 170, 0.3);
    }

    /* üìä ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä */
    canvas {
      background: #f0f8ff;
      border-radius: 14px;
      padding: 15px;
      box-shadow: 0 0 20px rgba(0, 119, 170, 0.25);
      border: 1px solid rgba(0, 119, 170, 0.25);
    }

    /* ‚öôÔ∏è ÿ™ÿ≠ÿ≥ŸäŸÜ ÿßŸÑŸÜÿµŸàÿµ */
    label {
      margin: 5px;
      font-size: 1.1rem;
      color: #004466;
    }

    /* ÿ™ŸÇŸäŸäŸÖ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÇÿ≥ */
    .weather-assessment {
      width: 95%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.8);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0, 119, 170, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 119, 170, 0.3);
      margin-bottom: 30px;
    }

    .overall-rating {
      text-align: center;
      margin-bottom: 25px;
      padding: 15px;
      background: rgba(240, 248, 255, 0.9);
      border-radius: 16px;
      border: 1px solid rgba(0, 119, 170, 0.3);
    }

    .rating-bar {
      width: 100%;
      height: 25px;
      background: #e0e0e0;
      border-radius: 12px;
      margin: 15px 0;
      overflow: hidden;
    }

    .rating-fill {
      height: 100%;
      border-radius: 12px;
      transition: width 0.5s ease;
    }

    .detailed-assessment h3 {
      color: #0077aa;
      border-bottom: 2px solid #0077aa;
      padding-bottom: 10px;
    }

    .assessment-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .assessment-item {
      background: rgba(240, 248, 255, 0.9);
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(0, 119, 170, 0.3);
    }

    .assessment-item h4 {
      margin-top: 0;
      color: #004466;
      border-bottom: 1px solid rgba(0, 119, 170, 0.3);
      padding-bottom: 8px;
    }

    /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ™ŸÇŸäŸäŸÖ */
    .rating-very-bad { background: linear-gradient(to right, #ff4d4d, #cc0000); }
    .rating-bad { background: linear-gradient(to right, #ff9966, #ff6600); }
    .rating-normal { background: linear-gradient(to right, #ffcc00, #ff9900); }
    .rating-good { background: linear-gradient(to right, #99cc33, #669900); }
    .rating-very-good { background: linear-gradient(to right, #66cc66, #339933); }

    /* ÿ•ÿ¥ÿπÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ */
    .data-type-notice {
      text-align: center;
      padding: 10px;
      margin: 15px 0;
      border-radius: 10px;
      font-weight: bold;
      display: none;
    }

    .historical-data {
      background-color: rgba(102, 204, 102, 0.2);
      border: 1px solid rgba(51, 153, 51, 0.5);
      color: #006600;
    }

    .predicted-data {
      background-color: rgba(255, 204, 0, 0.2);
      border: 1px solid rgba(204, 153, 0, 0.5);
      color: #996600;
    }

    /* ŸÇÿ≥ŸÖ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ */
    .weather-preferences {
      width: 95%;
      max-width: 1200px;
      background: rgba(255, 255, 255, 0.8);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0, 119, 170, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 119, 170, 0.3);
      margin-bottom: 30px;
    }

    .preferences-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .preference-item {
      background: rgba(240, 248, 255, 0.9);
      padding: 15px;
      border-radius: 12px;
      border: 1px solid rgba(0, 119, 170, 0.3);
    }

    .preference-item h4 {
      margin-top: 0;
      color: #004466;
      border-bottom: 1px solid rgba(0, 119, 170, 0.3);
      padding-bottom: 8px;
    }

    .slider-container {
      margin: 10px 0;
    }

    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .weather-type-checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
    }

    .checkbox-item input {
      margin-right: 5px;
    }

    /* ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ§ÿ¥ÿ± ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ */
    .preference-match {
      font-weight: bold;
      margin-top: 10px;
      padding: 5px 10px;
      border-radius: 8px;
      background: rgba(240, 248, 255, 0.9);
      display: inline-block;
    }
  </style>
</head>
<body>
  <h1>üåç Weather Prediction</h1>

  <!-- ÿ•ÿ¥ÿπÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ -->
  <div id="dataTypeNotice" class="data-type-notice"></div>

  <div id="map"></div>

  <div class="controls">
    <label>Day: <input type="number" id="day" min="1" max="31"></label>
    <label>Month: <input type="number" id="month" min="1" max="12"></label>
    <label>Year: <input type="number" id="year" min="2000" max="2100"></label>
    <br>

    <!-- ‚úÖ Dropdown ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿØŸäŸÜÿ© -->
    <label>Select City: 
      <select id="citySelect">
        <option value="">-- Choose a city --</option>
      </select>
    </label>
    <br>

    <!--  Dropdown ŸÑÿßÿÆÿ™Ÿäÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ™ŸÜÿ®ÿ§ -->
    <label>Show Prediction: 
      <select id="predictionType">
        <option value="temperature">üå°Ô∏è Temperature</option>
        <option value="humidity">üíß Humidity</option>
        <option value="windSpeed">üå¨Ô∏è Wind Speed</option>
        <option value="windDirection">üß≠ Wind Direction</option>
        <option value="precipitation">‚òî Precipitation</option>
        <option value="all" selected>üìä All</option>
      </select>
    </label>
    <br>
    <button id="showPredictionBtn">Show Prediction</button>
    <button onclick="downloadData('csv')">Download CSV</button>
    <button onclick="downloadData('json')">Download JSON</button>
  </div>

  <!-- ÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿßŸÑÿ∑ŸÇÿ≥ -->
  <div class="weather-preferences">
    <h2>‚öôÔ∏è Weather Preferences</h2>
    
    <div class="preferences-grid">
      <div class="preference-item">
        <h4>üå°Ô∏è Temperature Preferences</h4>
        <div class="slider-container">
          <div class="slider-label">
            <span>Cold</span>
            <span>Hot</span>
          </div>
          <input type="range" id="tempPreference" min="0" max="100" value="50" class="slider">
        </div>
        <div class="slider-container">
          <div class="slider-label">
            <span>Importance:</span>
            <span id="tempImportanceValue">5</span>
          </div>
          <input type="range" id="tempImportance" min="1" max="10" value="5" class="slider">
        </div>
      </div>
      
      <div class="preference-item">
        <h4>üíß Humidity Preferences</h4>
        <div class="slider-container">
          <div class="slider-label">
            <span>Dry</span>
            <span>Humid</span>
          </div>
          <input type="range" id="humidityPreference" min="0" max="100" value="50" class="slider">
        </div>
        <div class="slider-container">
          <div class="slider-label">
            <span>Importance:</span>
            <span id="humidityImportanceValue">5</span>
          </div>
          <input type="range" id="humidityImportance" min="1" max="10" value="5" class="slider">
        </div>
      </div>
      
      <div class="preference-item">
        <h4>üå¨Ô∏è Wind Preferences</h4>
        <div class="slider-container">
          <div class="slider-label">
            <span>Calm</span>
            <span>Windy</span>
          </div>
          <input type="range" id="windPreference" min="0" max="100" value="50" class="slider">
        </div>
        <div class="slider-container">
          <div class="slider-label">
            <span>Importance:</span>
            <span id="windImportanceValue">5</span>
          </div>
          <input type="range" id="windImportance" min="1" max="10" value="5" class="slider">
        </div>
      </div>
      
      <div class="preference-item">
        <h4>‚òî Precipitation Preferences</h4>
        <div class="slider-container">
          <div class="slider-label">
            <span>Dry</span>
            <span>Rainy</span>
          </div>
          <input type="range" id="precipPreference" min="0" max="100" value="50" class="slider">
        </div>
        <div class="slider-container">
          <div class="slider-label">
            <span>Importance:</span>
            <span id="precipImportanceValue">5</span>
          </div>
          <input type="range" id="precipImportance" min="1" max="10" value="5" class="slider">
        </div>
      </div>
    </div>
    
    <div class="preference-item">
      <h4>üå§Ô∏è Preferred Weather Types</h4>
      <div class="weather-type-checkboxes">
        <div class="checkbox-item">
          <input type="checkbox" id="prefSunny" checked>
          <label for="prefSunny">‚òÄÔ∏è Sunny</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="prefCloudy" checked>
          <label for="prefCloudy">‚òÅÔ∏è Cloudy</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="prefRainy" checked>
          <label for="prefRainy">üåßÔ∏è Rainy</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="prefSnowy" checked>
          <label for="prefSnowy">‚ùÑÔ∏è Snowy</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="prefStormy" checked>
          <label for="prefStormy">‚õàÔ∏è Stormy</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="prefWindy" checked>
          <label for="prefWindy">üí® Windy</label>
        </div>
      </div>
    </div>
    
    <div style="text-align: center; margin-top: 20px;">
      <button id="savePreferencesBtn">Save Preferences</button>
      <button id="resetPreferencesBtn">Reset to Default</button>
    </div>
  </div>

  <canvas id="chart" width="900" height="450"></canvas>

  <!-- ÿ™ŸÇŸäŸäŸÖ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ŸÇÿ≥ -->
  <div class="weather-assessment" id="weatherAssessment" style="display: none;">
    <h2>üå§Ô∏è Weather Assessment</h2>
    
    <!-- ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¥ÿßŸÖŸÑ -->
    <div class="overall-rating">
      <h3>Overall Weather Rating: <span id="overallRating"></span></h3>
      <div class="rating-bar">
        <div class="rating-fill" id="ratingFill"></div>
      </div>
      <p id="weatherRecommendation"></p>
      <p id="preferenceMatch">Preference Match: <span id="preferenceMatchValue"></span></p>
    </div>
    
    <!-- ÿ™ŸÅÿßÿµŸäŸÑ ÿ™ÿµŸÜŸäŸÅ ŸÉŸÑ ÿπŸÜÿµÿ± -->
    <div class="detailed-assessment">
      <h3>Detailed Assessment</h3>
      <div class="assessment-grid">
        <div class="assessment-item">
          <h4>üå°Ô∏è Temperature</h4>
          <p>Value: <span id="tempValue"></span>¬∞C</p>
          <p>Classification: <span id="tempClass"></span></p>
          <p>Comfort Level: <span id="tempComfort"></span></p>
          <p>Preference Match: <span id="tempPreferenceMatch"></span></p>
        </div>
        
        <div class="assessment-item">
          <h4>üíß Humidity</h4>
          <p>Value: <span id="humidityValue"></span>%</p>
          <p>Classification: <span id="humidityClass"></span></p>
          <p>Comfort Level: <span id="humidityComfort"></span></p>
          <p>Preference Match: <span id="humidityPreferenceMatch"></span></p>
        </div>
        
        <div class="assessment-item">
          <h4>üå¨Ô∏è Wind Speed</h4>
          <p>Value: <span id="windValue"></span> m/s</p>
          <p>Classification: <span id="windClass"></span></p>
          <p>Comfort Level: <span id="windComfort"></span></p>
          <p>Preference Match: <span id="windPreferenceMatch"></span></p>
        </div>
        
        <div class="assessment-item">
          <h4>‚òî Precipitation</h4>
          <p>Value: <span id="precipValue"></span> mm/day</p>
          <p>Classification: <span id="precipClass"></span></p>
          <p>Comfort Level: <span id="precipComfort"></span></p>
          <p>Preference Match: <span id="precipPreferenceMatch"></span></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let chart = null;
    let lastResult = null;
    let isHistoricalData = false;
    
    // ÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
    let userPreferences = {
      temperature: { preference: 50, importance: 5 },
      humidity: { preference: 50, importance: 5 },
      wind: { preference: 50, importance: 5 },
      precipitation: { preference: 50, importance: 5 },
      weatherTypes: {
        sunny: true,
        cloudy: true,
        rainy: true,
        snowy: true,
        stormy: true,
        windy: true
      }
    };

      const cities = {
      abuja: { name: "Abuja", coords: [9.0765, 7.3986], file: "POWER_Point_Daily_20000101_20251004_008d91N_007d18E_LST.json" },
          ouagadougou: { name: "Ouagadougou", coords: [12.3714, -1.5197], file: "Ouagadougou.json" },
      niamey: { name: "Niamey", coords: [13.5128, 2.1126], file: "Niamey.json" },
      ndjamena: { name: "N'Djamena", coords: [12.1348, 15.0557], file: "N'Djamena.json" },
      nairobi: { name: "Nairobi, Kenya", coords: [-1.2921, 36.8219], file: "Nairobi, KEN.json" },
      monrovia: { name: "Monrovia", coords: [6.3156, -10.8074], file: "Monrovia.json" },
      mcmurdo: { name: "McMurdo Station, Antarctica", coords: [-77.8419, 166.6863], file: "McMurdo Station, ATA.json" },
      malabo: { name: "Malabo", coords: [3.7523, 8.7737], file: "Malabo.json" },
      lome: { name: "Lom√©", coords: [6.1375, 1.2123], file: "Lom√©.json" },
      libreville: { name: "Libreville", coords: [0.4162, 9.4673], file: "Libreville.json" },
      kinshasa: { name: "Kinshasa", coords: [-4.4419, 15.2663], file: "Kinshasa.json" },
      kigali: { name: "Kigali", coords: [-1.9706, 30.1044], file: "Kigali.json" },
      kampala: { name: "Kampala", coords: [0.3476, 32.5825], file: "Kampala.json" },
      juba: { name: "Juba, South Sudan", coords: [4.8594, 31.5713], file: "Juba, Central Equatoria, SSD.json" },
      freetown: { name: "Freetown", coords: [8.4657, -13.2317], file: "Freetown.json" },
      dodoma: { name: "Dodoma", coords: [-6.1630, 35.7516], file: "Dodoma.json" },
      dakar: { name: "Dakar", coords: [14.7167, -17.4677], file: "Dakar.json" },
      conakry: { name: "Conakry", coords: [9.6412, -13.5784], file: "Conakry.json" },
      cairo: { name: "Cairo", coords: [30.0444, 31.2357], file: "Cairo POWER_Point_Daily_20000101_20250930_039d93N_116d39E_LST.json" },
      bujumbura: { name: "Bujumbura", coords: [-3.3614, 29.3599], file: "Bujumbura.json" },
      brazzaville: { name: "Brazzaville", coords: [-4.2634, 15.2429], file: "Brazzaville.json" },
      bissau: { name: "Bissau", coords: [11.8636, -15.5977], file: "Bissau.json" },
      banjul: { name: "Banjul", coords: [13.4549, -16.5790], file: "Banjul.json" },
      bangui: { name: "Bangui", coords: [4.3947, 18.5582], file: "Bangui.json" },
      bamako: { name: "Bamako", coords: [12.6392, -8.0029], file: "Bamako.json" },
      asmara: { name: "Asmara", coords: [15.3229, 38.9251], file: "Asmara.json" },
      antananarivo: { name: "Antananarivo", coords: [-18.8792, 47.5079], file: "Antananarivo.json" },
      addisababa: { name: "Addis Ababa", coords: [9.0319, 38.7408], file: "Addis Ababa.json" },
      accra: { name: "Accra", coords: [5.5600, -0.2057], file: "acra.json" },
      yaren: { name: "Yaren", coords: [-0.5477, 166.9209], file: "Yaren, NRU.json" },
      yaounde: { name: "Yaound√©", coords: [3.8480, 11.5021], file: "Yaound√©.json" },
      yamoussoukro: { name: "Yamoussoukro", coords: [6.8276, -5.2893], file: "Yamoussoukro.json" },
      wellington: { name: "Wellington", coords: [-41.2865, 174.7762], file: "Wellington, NZL.json" },
      washington: { name: "Washington", coords: [38.8951, -77.0364], file: "washington (2).json" },
      virginia: { name: "Virginia", coords: [37.4316, -78.6569], file: "VIRGINIA.json" },
      victoria: { name: "Victoria (Seychelles)", coords: [-4.6191, 55.4513], file: "VICTORIA-eychelles.json" },
      vancouver: { name: "Vancouver", coords: [49.2827, -123.1207], file: "Vancouver, BC, CAN.json" },
      valparaiso: { name: "Valpara√≠so", coords: [-33.0472, -71.6127], file: "Valpara√≠so, CHL.json" },
      valencia: { name: "Valencia (VEN)", coords: [10.1800, -68.0039], file: "Valencia, Carabobo, VEN.json" },
      trujillo: { name: "Trujillo", coords: [-8.11599, -79.02998], file: "Trujillo, La Libertad, PER.json" },
      toronto: { name: "Toronto", coords: [43.65107, -79.347015], file: "tronto.json" },
      tegucigalpa: { name: "Tegucigalpa", coords: [14.0818, -87.2068], file: "Tegucigalpa, HND.json" },
      tarawa: { name: "Tarawa", coords: [1.4518, 173.0327], file: "Tarawa, Gilbert Islands, KIR.json" },
      sydney: { name: "Sydney", coords: [-33.8688, 151.2093], file: "Sydney, New South Wales, AUS.json" },
      suva: { name: "Suva", coords: [-18.1248, 178.4501], file: "Suva.json" },
      sucre: { name: "Sucre", coords: [-19.0196, -65.2619], file: "Sucre, BOL.json" },
      sao_tome: { name: "S√£o Tom√©", coords: [0.3365, 6.7273], file: "S√£o Tom√©.json" },
      santo_domingo: { name: "Santo Domingo", coords: [18.4861, -69.9312], file: "Santo Domingo, DOM.json" },
      santiago: { name: "Santiago", coords: [-33.4489, -70.6693], file: "Santiago,CHL.json" },
      santa_cruz: { name: "Santa Cruz de la Sierra", coords: [-17.7833, -63.1821], file: "Santa Cruz de la Sierra, BOL.json" },
      san_jose: { name: "San Jos√©", coords: [9.9281, -84.0907], file: "san-jose costarica.json" },
      san_francisco: { name: "San Francisco", coords: [37.7749, -122.4194], file: "sanfransico.json" },
      san_salvador: { name: "San Salvador", coords: [13.6929, -89.2182], file: "san salavador.json" },
      saint_johns: { name: "Saint John's", coords: [17.1274, -61.8468], file: "Saint John's, Antigua, ATG.json" },
      saint_georges: { name: "Saint George's", coords: [12.0561, -61.7488], file: "Saint George's, Grenada, GRD.json" },
      roseau: { name: "Roseau", coords: [15.3010, -61.3870], file: "Roseau, DMA.json" },
      rio: { name: "Rio de Janeiro", coords: [-22.9068, -43.1729], file: "Rio de Janeiro, BRA.json" },
      quito: { name: "Quito", coords: [-0.1807, -78.4678], file: "Quito, ECU.json" },
      praia: { name: "Praia", coords: [14.9330, -23.5133], file: "Praia.json" },
      porto_novo: { name: "Porto-Novo", coords: [6.4969, 2.6289], file: "Porto-Novo.json" },
      port_au_prince: { name: "Port-au-Prince", coords: [18.5944, -72.3074], file: "Port-au-Prince,HTI.json" },
      port_vila: { name: "Port Vila", coords: [-17.7333, 168.3273], file: "Port Vila,VUT.json" },
      port_of_spain: { name: "Port of Spain", coords: [10.6549, -61.5019], file: "Port of Spain.json" },
      port_moresby: { name: "Port Moresby", coords: [-9.4438, 147.1803], file: "Port Moresby.json" },
      port_louis: { name: "Port Louis", coords: [-20.1609, 57.5012], file: "Port Louis.json" },
      perth: { name: "Perth", coords: [-31.9505, 115.8605], file: "Perth, Western Australia, AUS.json" },
      paramaribo: { name: "Paramaribo", coords: [5.8520, -55.2038], file: "Paramaribo, SUR.json" },
      panama_city: { name: "Panam√° City", coords: [8.9824, -79.5199], file: "Panam√°, PAN.json" },
      ottawa: { name: "Ottawa", coords: [45.4215, -75.6972], file: "Ottawa.json" },
      nukualofa: { name: "Nuku'alofa", coords: [-21.1394, -175.2049], file: "Nuku'alofa, Kolofo'ou, Tongatapu, TON.json" },
      ngerulmud: { name: "Ngerulmud", coords: [7.5004, 134.6243], file: "Ngerulmud, PLW.json" },
      new_york: { name: "New York", coords: [40.7128, -74.0060], file: "NewYork.json" },
      new_mexico: { name: "New Mexico", coords: [34.5199, -105.8701], file: "newmexico.json" },
      newjersey: { name: "New Jersey", coords: [40.0583, -74.4057], file: "NEWJERSEY.json" },
      new_mexico2: { name: "New Mexico (2)", coords: [34.5199, -105.8701], file: "NEW MEXICO.json" },
      nassau: { name: "Nassau", coords: [25.0343, -77.3963], file: "Nassau, BHS.json" },
      montreal: { name: "Montr√©al", coords: [45.5019, -73.5674], file: "Montr√©al, QC, CAN.json" },
      monterrey: { name: "Monterrey", coords: [25.6866, -100.3161], file: "Monterrey.json" },
      miami: { name: "Miami", coords: [25.7617, -80.1918], file: "Miami, FL, USA.json" },
      melbourne: { name: "Melbourne", coords: [-37.8136, 144.9631], file: "Melbourne, Victoria, AUS.json" },
      michigan: { name: "Michigan", coords: [44.3148, -85.6024], file: "MECHIGAN.json" },
      mar_del_plata: { name: "Mar del Plata", coords: [-38.0055, -57.5426], file: "Mar del Plata, General Pueyrred√≥n, Provincia de Buenos Aires, ARG.json" },
      manaus: { name: "Manaus", coords: [-3.1190, -60.0217], file: "Manaus, Amazonas, BRA.json" },
      managua: { name: "Managua", coords: [12.1140, -86.2362], file: "Managua, NIC.json" },
      majuro: { name: "Majuro", coords: [7.0897, 171.3803], file: "Majuro, MHL.json" },
      los_angeles: { name: "Los Angeles", coords: [34.0522, -118.2437], file: "Los Angeles, USA.json" },
      london: { name: "London", coords: [51.5074, -0.1278], file: "london.json" },
      lima: { name: "Lima", coords: [-12.0464, -77.0428], file: "Lima, PER.json" },
      havana: { name: "Havana", coords: [23.1136, -82.3666], file: "La Habana, CUB.json" },
      kingstown: { name: "Kingstown", coords: [13.1600, -61.2248], file: "KINGSTOWN.json" },
      kingston: { name: "Kingston", coords: [17.9712, -76.7936], file: "Kingston, JAM.json" },
      honiara: { name: "Honiara", coords: [-9.4456, 159.9729], file: "Honiara, SLB.json" },
      guatemala_city: { name: "Guatemala City", coords: [14.6349, -90.5069], file: "guatemala.json" },
      greenland: { name: "Greenland", coords: [71.7069, -42.6043], file: "GREENLAND.json" },
      georgetown: { name: "Georgetown", coords: [6.8013, -58.1551], file: "Georgetown,GUY.json" },
      funafuti: { name: "Funafuti", coords: [-8.5201, 179.1970], file: "Funafuti, TUV.json" },
      cuenca: { name: "Cuenca", coords: [-2.9001, -79.0059], file: "Cuenca, ECU.json" },
      ciudad_del_este: { name: "Ciudad del Este", coords: [-25.5167, -54.6167], file: "Ciudad del Este-par.json" },
      castries: { name: "Castries", coords: [13.9094, -60.9789], file: "Castries, LCA.json" },
      caracas: { name: "Caracas", coords: [10.4806, -66.9036], file: "Caracas, Municipio Libertador, Distrito Capital, VEN.json" },
      canberra: { name: "Canberra", coords: [-35.2809, 149.1300], file: "Canberra.json" },
      california: { name: "California", coords: [36.7783, -119.4179], file: "california-America.json" },
      cali: { name: "Cali", coords: [3.4516, -76.5320], file: "Cali, Valle del Cauca, COL.json" },
      buenos_aires1: { name: "Buenos Aires", coords: [-34.6037, -58.3816], file: "Buenos Aires,ARG.json" },
      buenos_aires2: { name: "Buenos Aires", coords: [-34.6037, -58.3816], file: "Buenos Aires, ARG.json" },
      bridgetown: { name: "Bridgetown", coords: [13.1939, -59.5432], file: "Bridgetown, Saint Michel, BRB.json" },
      brasilia: { name: "Bras√≠lia", coords: [-15.8267, -47.9218], file: "Bras√≠lia, BRA.json" },
      bogota: { name: "Bogot√°", coords: [4.7110, -74.0721], file: "Bogot√°,COL.json" },
      belmopan: { name: "Belmopan", coords: [17.2510, -88.7590], file: "belmopan-BLZ.json" },
      basseterre: { name: "Basseterre", coords: [17.3026, -62.7177], file: "Basseterre.json" },
      asuncion: { name: "Asunci√≥n", coords: [-25.2637, -57.5759], file: "Asunci√≥n,PY.json" },
      arizona: { name: "Arizona", coords: [34.0489, -111.0937], file: "Arizona.json" },
      apia: { name: "Apia", coords: [-13.8333, -171.7667], file: "Apia, WSM.json" },
 kathmandu: { name: "Kathmandu", coords: [27.712, 85.313], file: "Kathmandu NEPAL.json" }, 
himachal: { name: "Himachal", coords: [31.031, 76.784], file: "Himachal INDIA.json" }, 
brunei: { name: "Brunei", coords: [4.584, 114.215], file: "Brunei.json" }, 
kuala_lumpur: { name: "Kuala Lumpur", coords: [3.140853, 101.693207], file: "Kuala Lumpur, Wilayah Persekutuan Kuala Lumpur, MYS.json" }, 
tokyo_gaien_campus: { name: "Kyoto Geijutsu Univ. Tohoku Univ. of Art & Design Gaien Campus, Minato, Tokyo, JPN", coords: [35.6663, 139.7173], file: "Kyoto Geijutsu Univ. Tohoku Univ. of Art & Design Gaien Campus, Minato, Tokyo, JPN.json" }, 
lahore: { name: "Lahore, Pakistan", coords: [31.5204, 74.3587], file: "Lahore pakistan.json" }, 
luang_prabang: { name: "Luang Prabang", coords: [19.8933, 102.1350], file: "Luang Prabang.json" }, 
male: { name: "Mal√©, MV", coords: [4.1755, 73.5093], file: "Mal√© MV.json" }, 
manila: { name: "Manila, Metro Manila, National Capital Region, PHL", coords: [14.5995, 120.9842], file: "Manila, Metro Manila, National Capital Region, PHL.json" }, 
mumbai: { name: "Mumbai, India", coords: [19.0760, 72.8777], file: "Mumbai india.json" }, 
naypyidaw: { name: "Naypyidaw, Nay Pyi Taw Union Territory, MMR", coords: [19.7633, 96.0785], file: "Naypyidaw, Nay Pyi Taw Union Territory, MMR.json" }, 
osaka_ohsho: { name: "Osaka Ohsho, Shinjuku, Tokyo, JPN", coords: [35.6938, 139.7034], file: "Osaka Ohsho, Shinjuku, Tokyo, JPN.json" }, 
phnom_penh: { name: "Phnom Penh, KHM", coords: [11.5564, 104.9282], file: "Phnom Penh, KHM.json" }, 
pokhara: { name: "Pokhara, Nepal", coords: [28.2096, 83.9856], file: "Pokhara NEPAL.json" }, 
pyongyang: { name: "Pyongyang, P'Yongyang-Si, PRK", coords: [39.0392, 125.7625], file: "Pyongyang, P'Yongyang-Si, PRK.json" }, 
quezon_city: { name: "Quezon City, Metro Manila, National Capital Region, PHL", coords: [14.6760, 121.0437], file: "Quezon City Metro Manila, National Capita.json" }, 
samarkand: { name: "Samarkand, UZB", coords: [39.6542, 66.9597], file: "Samarkand, UZB.json" }, 
savannakhet: { name: "Savannakhet, Kaysone Phomvihane, LAO", coords: [16.5703, 104.7607], file: "Savannakhet, Kaysone Pho.json" }, 
seoul: { name: "Seoul, KOR", coords: [37.5665, 126.9780], file: "Seoul, KOR.json" }, 
seria_rotonda_monument: { name: "Seria Rotonda Monument, Jalan Pandan Lima, Kampung Mumong A, Belait, BRN", coords: [4.6097, 114.3247], file: "Seria Rotonda Monument, Jalan Pandan Lima, Kampung Mumong A, Belait, BRN.json" }, 
shymkent: { name: "Shymkent, KAZ", coords: [42.3417, 69.5901], file: "Shymkent, KAZ.json" }, 
siem_reap: { name: "Siem Reap, KHM", coords: [13.3671, 103.8448], file: "Siem Reap, KHM.json" }, 
singapore: { name: "Singapore, SGP", coords: [1.3521, 103.8198], file: "Singapore, SGP.json" }, 
sri_jayawardenepura_kotte: { name: "Sri Jayawardenepura Kotte, Sri Lanka", coords: [6.9271, 79.8612], file: "Sri Jayawardenepura Kotte SRI LANKA.json" }, 
surabaya: { name: "Surabaya, Jawa Timur, IDN", coords: [-7.2575, 112.7521], file: "Surabaya, Jawa Timur, IDN.json" }, 
taipei: { name: "Taipei City, TWN", coords: [25.0330, 121.5654], file: "Taipei City, TWN.json" }, 
tashkent: { name: "Tashkent, UZB", coords: [41.2995, 69.2401], file: "Tashkent, UZB.json" }, 
tokyo: { name: "Tokyo, JPN", coords: [35.6895, 139.6917], file: "Tokyo, JPN.json" }, 
turkmenabat: { name: "T√ºrkmenabat, Lebap, TKM", coords: [39.0747, 63.5785], file: "T√ºrkmenabat, Lebap, TKM.json" }, 
ulaanbaatar: { name: "Ulaanbaatar, Sukhbaatar, Ulaanbaatar, MNG", coords: [47.9183, 106.9170], file: "Ulaanbaatar, Sukhbaatar, Ulaanbaatar, MNG.json" }, 
vientiane: { name: "Vientiane, Chanthabuly, Vientiane Capital, LAO", coords: [17.9757, 102.6331], file: "Vientiane, Chanthabuly, Vientiane Capital, LAO.json" }, 
yangon: { name: "Yangon, MMR", coords: [16.8409, 96.1735], file: "Yangon MMR.json" },
addu_city: { name: "Addu City, Addu Atoll, MDV", coords: [-0.6308, 73.1580], file: "Addu City, Addu Atoll, MDV.json" }, 
almaty: { name: "Almaty, KAZ", coords: [43.2220, 76.8512], file: "Almaty, KAZ.json" }, 
ashgabat: { name: "Ashgabat, TKM", coords: [37.9601, 58.3261], file: "Ashgabat, TKM.json" }, 
astana: { name: "Astana, KAZ", coords: [51.1605, 71.4704], file: "Astana, KAZ.json" }, 
bandar_seri_begawan: { name: "Bandar Seri Begawan, BRN", coords: [4.9031, 114.9398], file: "Bandar Seri Begawan, BRN.json" }, 
bandung: { name: "Bandung, Jawa Barat, IDN", coords: [-6.9175, 107.6191], file: "Bandung, Jawa Barat, IDN.json" }, 
bishkek: { name: "Bishkek, KGZ", coords: [42.8746, 74.5698], file: "Bishkek, KGZ.json" }, 
biratnagar: { name: "Biratnagar, NEPAL", coords: [26.4550, 87.2718], file: "Biratnagar NEPAL.json" }, 
beijing: { name: "Beijing, CHN", coords: [39.9042, 116.4074], file: "Beijing, CHN.json" }, 
baucau: { name: "Baucau, TLS", coords: [-8.4716, 126.4570], file: "Baucau, TLS.json" }, 
bangkok: { name: "Bangkok, Phra Nakhon, Bangkok, THA", coords: [13.7563, 100.5018], file: "Bangkok, Phra Nakhon, Bangkok, THA.json" }, 
bangalore: { name: "Bangalore, India", coords: [12.9716, 77.5946], file: "Bangalore india.json" }, 
busan: { name: "Busan, KOR", coords: [35.1796, 129.0756], file: "Busan KOR.json" }, 
cebu_city: { name: "Cebu City, Cebu, Central Visayas, PHL", coords: [10.3157, 123.8854], file: "Cebu City, Cebu, Central Visayas, PHL.json" }, 
chiang_mai: { name: "Chiang Mai Khaep Mu Prachathipok Rd., Somdet Chaophraya, Khlong San, Bangkok 10600, THA", coords: [18.7883, 98.9853], file: "Chiang Mai Khaep Mu Prachathipok Rd., Somdet Chaophraya, Khlong San, Bangkok 10600, THA.json" }, 
chittagong: { name: "Chittagong, BGD", coords: [22.3569, 91.7832], file: "Chittagong BGD.json" }, 
colombo: { name: "Colombo, SRI LANKA", coords: [6.9271, 79.8612], file: "Colombo SRI LANKA.json" }, 
da_nang: { name: "Da Nang, VNM", coords: [16.0471, 108.2068], file: "Da Nang, VNM.json" }, 
dhaka: { name: "Dhaka, Bangladesh", coords: [23.8103, 90.4125], file: "Dhaka bangladish.json" }, 
dili: { name: "Dili, Vera Cruz, D√≠li, TLS", coords: [-8.5569, 125.5603], file: "Dili, Vera Cruz, D√≠li, TLS.json" }, 
dushanbe_india: { name: "Dushanbe, India", coords: [28.6139, 77.2090], file: "Dushanbe India.json" }, 
dushanbe: { name: "Dushanbe, TJK", coords: [38.5598, 68.7870], file: "Dushanbe, TJK.json" }, 
erdenet: { name: "Erdenet, Orhon, MNG", coords: [49.0331, 104.0444], file: "Erdenet, Orhon, MNG.json" }, 
guangzhou: { name: "Guangzhou, Guangdong, CHN", coords: [23.1291, 113.2644], file: "Guangzhou, Guangdong, CHN.json" }, 
hamhung: { name: "Hamhung, Hamgyong-Namdo, PRK", coords: [39.9183, 127.5364], file: "Hamhung, Hamgyong-Namdo, PRK.json" }, 
hanoi: { name: "Hanoi, VNM", coords: [21.0278, 105.8342], file: "Hanoi, VNM.json" }, 
hiroshima: { name: "Hiroshima, JPN", coords: [34.3853, 132.4553], file: "Hiroshima, JPN.json" }, 
hong_kong: { name: "Hong Kong, CHN", coords: [22.3193, 114.1694], file: "Hong Kong CHN.json" }, 
islamabad: { name: "Islamabad, Pakistan", coords: [33.6844, 73.0479], file: "islamabad pakstan.json" }, 
jakarta: { name: "Jakarta Special Capital Region, Jakarta, IDN", coords: [-6.2088, 106.8456], file: "Jakarta Special Capital Region, Jakarta, IDN.json" }, 
jalalabad: { name: "Jalalabad, Shahjahanpur, Uttar Pradesh, IND", coords: [27.6167, 79.6667], file: "Jalalabad, Shahjahanpur, Uttar Pradesh, IND.json" }, 
kandy: { name: "Kandy, SRI LANKA", coords: [7.2906, 80.6337], file: "Kandy SRI LANKA.json" }, 
kaohsiung: { name: "Kaohsiung City, TWN", coords: [22.6273, 120.3014], file: "Kaohsiung City, TWN.json" }, 
karachi: { name: "Karachi, Pakistan", coords: [24.8607, 67.0011], file: "Karachi pakstan.json" }, 
kolkata: { name: "Kolkata, India", coords: [22.5726, 88.3639], file: "Kolkata india.json" }, 
kuala_belait: { name: "Kuala Belait, Belait, BRN", coords: [4.5836, 114.2312], file: "Kuala Belait, Belait, BRN.json" },
     kuala_lumpur: { name: "Kuala Lumpur", coords: [3.140853, 101.693207], file: "Kuala Lumpur, Wilayah Persekutuan Kuala Lumpur, MYS.json" },
     cape_town: { name: "Cape Town Legislature, South Africa", coords: [-33.9249, 18.4241], file: "Cape Town Legislature South Africa.json" }, 
gaborone: { name: "Gaborone, Botswana", coords: [-24.6282, 25.9231], file: "Gaborone (Botswana).json" }, 
harare: { name: "Harare, Zimbabwe", coords: [-17.8252, 31.0335], file: "Harare (Zimbabwe).json" }, 
lilongwe: { name: "Lilongwe, Malawi", coords: [-13.9626, 33.7741], file: "Lilongwe (Malawi).json" }, 
lobamba: { name: "Lobamba, Eswatini (formerly Swaziland)", coords: [-26.4527, 31.1409], file: "Lobamba (Eswatini (formerly Swaziland)).json" }, 
luanda: { name: "Luanda, Angola", coords: [-8.8390, 13.2894], file: "Luanda (Angola).json" }, 
lusaka: { name: "Lusaka, Zambia", coords: [-15.3875, 28.3228], file: "Lusaka (Zambia).json" }, 
maputo: { name: "Maputo, Mozambique", coords: [-25.9692, 32.5732], file: "Maputo (Mozambique).json" }, 
maseru: { name: "Maseru, Lesotho", coords: [-29.3158, 27.4854], file: "Maseru (Lesotho).json" }, 
pretoria: { name: "Pretoria (Administrative), South Africa", coords: [-25.7479, 28.2293], file: "Pretoria (Administrative) South Africa.json" }, 
windhoek: { name: "Windhoek, Namibia", coords: [-22.5609, 17.0658], file: "Windhoek (Namibia).json" }, 
aden: { name: "Aden, Yemen", coords: [12.7855, 45.0187], file: "Aden (Yemen).json" }, 
aleppo: { name: "Aleppo, Syria", coords: [36.2021, 37.1343], file: "Aleppo (Syria).json" }, 
damascus: { name: "Damascus, Syria", coords: [33.5138, 36.2765], file: "Damascus.json" }, 
djibouti: { name: "Djibouti, Djibouti", coords: [11.8251, 42.5903], file: "Djibouti.json" }, 
dubai: { name: "Dubai, UAE", coords: [25.2048, 55.2708], file: "Dubai (UAE).json" }, 
hargeisa: { name: "Hargeisa, Somalia", coords: [9.5592, 44.0620], file: "Hargeisa (Somalia).json" }, 
mecca: { name: "Mecca, Saudi Arabia", coords: [21.3891, 39.8579], file: "Mecca (Saudi Arabia).json" }, 
misurata: { name: "Misurata, Libya", coords: [32.3759, 15.0920], file: "Misurata (Libya).json" }, 
mogadishu: { name: "Mogadishu, Somalia", coords: [2.0469, 45.3182], file: "Mogadishu (Somalia).json" }, 
moroni: { name: "Moroni, Djibouti", coords: [-11.7042, 43.2402], file: "Moroni (Djibouti).json" }, 
muscat: { name: "Muscat, Oman", coords: [23.5880, 58.3829], file: "Muscat (Oman).json" }, 
nouadhibou: { name: "Nouadhibou, Mauritania", coords: [20.9283, -17.0300], file: "Nouadhibou (Mauritania).json" }, 
nouakchott: { name: "Nouakchott, Mauritania", coords: [18.0735, -15.9582], file: "Nouakchott (Mauritania).json" }, 
oman: { name: "Oman", coords: [21.5126, 55.9233], file: "Oman.json" }, 
oran: { name: "Oran, Algeria", coords: [35.6969, -0.6413], file: "Oran (Algeria).json" }, 
salalah: { name: "Salalah, Oman", coords: [17.0190, 54.0898], file: "Salalah (Oman).json" }, 
sanaa: { name: "Sana'a, Yemen", coords: [15.3694, 44.1910], file: "Sana'a.json" }, 
sfax: { name: "Sfax, Tunisia", coords: [34.7406, 10.7603], file: "Sfax (Tunisia).json" }, 
tripoli_libya: { name: "Tripoli, Libya", coords: [32.8872, 13.1913], file: "Tripoli.json" }, 
tripoli_lebanon: { name: "Tripoli, Lebanon", coords: [34.4367, 35.8496], file: "Tripoli (Lebanon).json" }, 
tunisia: { name: "Tunisia", coords: [33.8869, 9.5375], file: "Tunisia.json" },
chisinau: { name: "Chisinau, Moldova", coords: [47.0105, 28.8638], file: "Chisinau (Moldova).json" },
copenhagen: { name: "Copenhagen, Denmark", coords: [55.6761, 12.5683], file: "Copenhagen (Denmark).json" },
helsinki: { name: "Helsinki, Finland", coords: [60.1695, 24.9354], file: "Helsinki (Finland).json" },
kyiv: { name: "Kyiv, Ukraine", coords: [50.4501, 30.5234], file: "Kyiv (Ukraine).json" },
lisbon: { name: "Lisbon, Portugal", coords: [38.7169, -9.1395], file: "Lisbon (Portugal).json" },
ljubljana: { name: "Ljubljana, Slovenia", coords: [46.0569, 14.5058], file: "Ljubljana (Slovenia).json" },
london: { name: "London, United Kingdom", coords: [51.5074, -0.1278], file: "London (United Kingdom).json" },
luxembourg: { name: "Luxembourg, Luxembourg", coords: [49.6117, 6.1319], file: "Luxembourg (Luxembourg).json" },
madrid: { name: "Madrid, Spain", coords: [40.4168, -3.7038], file: "Madrid (Spain).json" },
minsk: { name: "Minsk, Belarus", coords: [53.9006, 27.5590], file: "Minsk (Belarus).json" },
moscow: { name: "Moscow, Russia", coords: [55.7558, 37.6173], file: "Moscow (Russia).json" },
nicosia: { name: "Nicosia, Cyprus", coords: [35.1856, 33.3823], file: "Nicosia (Cyprus).json" },
san_marino: { name: "San Marino, San Marino", coords: [43.9336, 12.4483], file: "San Marino(San Marino).json" },
sarajevo: { name: "Sarajevo, Bosnia and Herzegovina", coords: [43.8563, 18.4131], file: "Sarajevo (Bosnia and Herzegovina).json" },
skopje: { name: "Skopje, North Macedonia", coords: [41.9981, 21.4254], file: "Skopje (North Macedonia).json" },
sofia: { name: "Sofia, Bulgaria", coords: [42.6977, 23.3219], file: "Sofia (Bulgaria).json" },
stockholm: { name: "Stockholm, Sweden", coords: [59.3293, 18.0686], file: "Stockholm (Sweden).json" },
vaduz: { name: "Vaduz, Liechtenstein", coords: [47.1417, 9.5215], file: "Vaduz (Liechtenstein).json" },
valletta: { name: "Valletta, Malta", coords: [35.8997, 14.5146], file: "Valletta (Malta).json" },
vatican_city: { name: "Vatican City, Vatican", coords: [41.9029, 12.4534], file: "Vatican City (Vatican).json" },
vienna: { name: "Vienna, Austria", coords: [48.2082, 16.3738], file: "Vienna (Austria).json" },
vilnius: { name: "Vilnius, Lithuania", coords: [54.6872, 25.2797], file: "Vilnius (Lithuania).json" },
warsaw: { name: "Warsaw, Poland", coords: [52.2297, 21.0122], file: "Warsaw (Poland).json" },
yerevan: { name: "Yerevan, Armenia", coords: [40.1792, 44.4991], file: "Yerevan (Armenia).json" },
athens: { name: "Athens, Greece", coords: [37.9838, 23.7275], file: "athens greece.json" },
amsterdam: { name: "Amsterdam, Netherlands", coords: [52.3676, 4.9041], file: "amesterdam.json" },
andorra_la_vella: { name: "Andorra la Vella, Andorra", coords: [42.5078, 1.5211], file: "andorra la vella.json" },
ankara: { name: "Ankara, Turkey", coords: [39.9334, 32.8597], file: "ankara turkey.json" },
baku: { name: "Baku, Azerbaijan", coords: [40.4093, 49.8671], file: "baku azerbaijan.json" },
belgrade: { name: "Belgrade, Serbia", coords: [44.8176, 20.4569], file: "belgrade serbia.json" },
bern: { name: "Bern, Switzerland", coords: [46.9481, 7.4474], file: "bern switzerland.json" },
bratislava: { name: "Bratislava, Slovakia", coords: [48.1486, 17.1077], file: "bratislava slovakia.json" },
brussels: { name: "Brussels, Belgium", coords: [50.8503, 4.3517], file: "brussels belgium.json" },
budapest: { name: "Budapest, Hungary", coords: [47.4979, 19.0402], file: "budapest hungary.json" },
dublin: { name: "Dublin, Ireland", coords: [53.3331, -6.2489], file: "dulbin ireland.json" },
oslo: { name: "Oslo, Norway", coords: [59.9139, 10.7522], file: "oslo norway.json" },
paris: { name: "Paris, France", coords: [48.8566, 2.3522], file: "paris france.json" },
podgorica: { name: "Podgorica, Montenegro", coords: [42.4410, 19.2620], file: "podgorica nibtebgir.json" },
prague: { name: "Prague, Czech Republic", coords: [50.0755, 14.4378], file: "prague czech republic.json" },
pristina: { name: "Pristina, Kosovo", coords: [42.6629, 21.1655], file: "pristina kosove.json" },
riga: { name: "Riga, Latvia", coords: [56.9496, 24.1052], file: "riga latvia.json" },
roma: { name: "Rome, Italy", coords: [41.9028, 12.4964], file: "roma italy.json" },
tallinn: { name: "Tallinn, Estonia", coords: [59.4370, 24.7536], file: "tallinn estinia.json" },
tbilisi: { name: "Tbilisi, Georgia", coords: [41.7151, 44.8271], file: "tblilsi georgia.json" },
tirana: { name: "Tirana, Albania", coords: [41.3275, 19.8189], file: "tiranda albania.json" },
zagreb: { name: "Zagreb, Croatia", coords: [45.8150, 15.9785], file: "zagreb croatia.json" },
rabat: { name: "Rabat, Morocco", coords: [34.0209, -6.8417], file: "rabat (2).json" },
reykjavik: { name: "Reykjavik, Iceland", coords: [64.1355, -21.8954], file: "capital of iceland.json" },
tehran: { name: "Tehran, Iran", coords: [35.6892, 51.3890], file: "tahran.json" },
baghdad: { name: "Baghdad, Iraq", coords: [33.3152, 44.3661], file: "baghdad.json" }


    };

    // ‚úÖ ÿ®ŸÜÿßÿ° Dropdown ŸÖŸÜ ÿßŸÑŸÖÿØŸÜ
    const citySelect = document.getElementById("citySelect");
    for (const key in cities) {
      const option = document.createElement("option");
      option.value = key;
      option.textContent = cities[key].name;
      citySelect.appendChild(option);
    }

    // ‚úÖ ÿÆÿ±Ÿäÿ∑ÿ©
    const map = L.map("map").setView([10, 20], 3);

    const osmLayer = L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png", {
      attribution: '&copy; OpenStreetMap &copy; CARTO',
      subdomains: 'abcd',
      maxZoom: 19,
      noWrap: true
    }).addTo(map);

    // ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÑÿßŸÖÿßÿ™ ŸÑŸÑŸÖÿØŸÜ
    for (const key in cities) {
      const city = cities[key];
      const marker = L.marker(city.coords).addTo(map);
      marker.bindPopup(`<b>${city.name}</b><br>Click to select`);
      marker.on("click", () => {
        citySelect.value = key;
        map.setView(city.coords, 10);
        showData(city);
      });
    }

    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
    const showPredictionBtn = document.getElementById("showPredictionBtn");
    showPredictionBtn.addEventListener("click", () => {
      const key = citySelect.value;
      if (!key) { alert("ÿßÿÆÿ™ÿ± ŸÖÿØŸäŸÜÿ© ÿ£ŸàŸÑÿß!"); return; }
      const city = cities[key];
      map.setView(city.coords, 10);
      showData(city);
    });

    citySelect.addEventListener("change", () => {
      const key = citySelect.value;
      if (key && cities[key]) {
        map.setView(cities[key].coords, 10);
      }
    });

    // ‚úÖ ÿØŸàÿßŸÑ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™

    // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ŸÖŸÜ localStorage
    function loadPreferences() {
      const saved = localStorage.getItem('weatherPreferences');
      if (saved) {
        userPreferences = JSON.parse(saved);
        updatePreferenceUI();
      }
    }

    // ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿ•ŸÑŸâ localStorage
    function savePreferences() {
      // ÿ™ÿ≠ÿØŸäÿ´ userPreferences ŸÖŸÜ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
      userPreferences.temperature.preference = parseInt(document.getElementById('tempPreference').value);
      userPreferences.temperature.importance = parseInt(document.getElementById('tempImportance').value);
      
      userPreferences.humidity.preference = parseInt(document.getElementById('humidityPreference').value);
      userPreferences.humidity.importance = parseInt(document.getElementById('humidityImportance').value);
      
      userPreferences.wind.preference = parseInt(document.getElementById('windPreference').value);
      userPreferences.wind.importance = parseInt(document.getElementById('windImportance').value);
      
      userPreferences.precipitation.preference = parseInt(document.getElementById('precipPreference').value);
      userPreferences.precipitation.importance = parseInt(document.getElementById('precipImportance').value);
      
      userPreferences.weatherTypes.sunny = document.getElementById('prefSunny').checked;
      userPreferences.weatherTypes.cloudy = document.getElementById('prefCloudy').checked;
      userPreferences.weatherTypes.rainy = document.getElementById('prefRainy').checked;
      userPreferences.weatherTypes.snowy = document.getElementById('prefSnowy').checked;
      userPreferences.weatherTypes.stormy = document.getElementById('prefStormy').checked;
      userPreferences.weatherTypes.windy = document.getElementById('prefWindy').checked;
      
      localStorage.setItem('weatherPreferences', JSON.stringify(userPreferences));
      alert('Preferences saved successfully!');
    }

    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿ•ŸÑŸâ ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
    function resetPreferences() {
      userPreferences = {
        temperature: { preference: 50, importance: 5 },
        humidity: { preference: 50, importance: 5 },
        wind: { preference: 50, importance: 5 },
        precipitation: { preference: 50, importance: 5 },
        weatherTypes: {
          sunny: true,
          cloudy: true,
          rainy: true,
          snowy: true,
          stormy: true,
          windy: true
        }
      };
      
      updatePreferenceUI();
      localStorage.setItem('weatherPreferences', JSON.stringify(userPreferences));
      alert('Preferences reset to default!');
    }

    // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
    function updatePreferenceUI() {
      document.getElementById('tempPreference').value = userPreferences.temperature.preference;
      document.getElementById('tempImportance').value = userPreferences.temperature.importance;
      document.getElementById('tempImportanceValue').textContent = userPreferences.temperature.importance;
      
      document.getElementById('humidityPreference').value = userPreferences.humidity.preference;
      document.getElementById('humidityImportance').value = userPreferences.humidity.importance;
      document.getElementById('humidityImportanceValue').textContent = userPreferences.humidity.importance;
      
      document.getElementById('windPreference').value = userPreferences.wind.preference;
      document.getElementById('windImportance').value = userPreferences.wind.importance;
      document.getElementById('windImportanceValue').textContent = userPreferences.wind.importance;
      
      document.getElementById('precipPreference').value = userPreferences.precipitation.preference;
      document.getElementById('precipImportance').value = userPreferences.precipitation.importance;
      document.getElementById('precipImportanceValue').textContent = userPreferences.precipitation.importance;
      
      document.getElementById('prefSunny').checked = userPreferences.weatherTypes.sunny;
      document.getElementById('prefCloudy').checked = userPreferences.weatherTypes.cloudy;
      document.getElementById('prefRainy').checked = userPreferences.weatherTypes.rainy;
      document.getElementById('prefSnowy').checked = userPreferences.weatherTypes.snowy;
      document.getElementById('prefStormy').checked = userPreferences.weatherTypes.stormy;
      document.getElementById('prefWindy').checked = userPreferences.weatherTypes.windy;
    }

    // ÿ™ÿ≠ÿØŸäÿ´ ŸÇŸäŸÖ ÿßŸÑÿ£ŸáŸÖŸäÿ© ÿπŸÜÿØ ÿ™ÿ≠ÿ±ŸäŸÉ ÿßŸÑÿ≥ŸÑÿßŸäÿØÿ±
    document.getElementById('tempImportance').addEventListener('input', function() {
      document.getElementById('tempImportanceValue').textContent = this.value;
    });
    
    document.getElementById('humidityImportance').addEventListener('input', function() {
      document.getElementById('humidityImportanceValue').textContent = this.value;
    });
    
    document.getElementById('windImportance').addEventListener('input', function() {
      document.getElementById('windImportanceValue').textContent = this.value;
    });
    
    document.getElementById('precipImportance').addEventListener('input', function() {
      document.getElementById('precipImportanceValue').textContent = this.value;
    });

    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ±
    document.getElementById('savePreferencesBtn').addEventListener('click', savePreferences);
    document.getElementById('resetPreferencesBtn').addEventListener('click', resetPreferences);

    // ‚úÖ ÿßŸÑÿØŸàÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑŸÖŸÅŸÇŸàÿØÿ©

    // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÇÿ®ŸÑ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÇÿ∑ÿπ (4 ÿ£ŸÉÿ™Ÿàÿ®ÿ± 2025)
    function isBeforeCutoffDate(day, month, year) {
      const cutoffDate = new Date(2025, 9, 4); // 4 ÿ£ŸÉÿ™Ÿàÿ®ÿ± 2025
      const inputDate = new Date(year, month - 1, day);
      return inputDate < cutoffDate;
    }

    // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÑŸÖÿ¨ŸÖŸàÿπÿ© ÿ®ŸäÿßŸÜÿßÿ™
    function calculateStats(dataArray) {
      if (dataArray.length === 0) return { mean: 0, stdDev: 0 };
      
      const mean = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;
      const variance = dataArray.reduce((sum, value) => sum + Math.pow(value - mean, 2), 0) / dataArray.length;
      const stdDev = Math.sqrt(variance);
      
      return { mean, stdDev };
    }

    // ÿ™ŸàŸÑŸäÿØ ŸÇŸäŸÖÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ ŸàÿßŸÑÿßŸÜÿ≠ÿ±ÿßŸÅ ÿßŸÑŸÖÿπŸäÿßÿ±Ÿä
    function getRandomValue(mean, stdDev) {
      // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ÿ≠ŸàŸäŸÑ Box-Muller ŸÑÿ™ŸàŸÑŸäÿØ ÿ™Ÿàÿ≤Ÿäÿπ ÿ∑ÿ®ŸäÿπŸä
      let u = 0, v = 0;
      while(u === 0) u = Math.random();
      while(v === 0) v = Math.random();
      const normal = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
      
      return mean + stdDev * normal;
    }

    // ‚úÖ ÿØŸàÿßŸÑ ÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ∑ŸÇÿ≥

    // ÿØÿßŸÑÿ© ŸÑÿ™ÿµŸÜŸäŸÅ ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ©
    function classifyTemperature(temp) {
      if (temp < 10) return { class: "Very Cold", comfort: "very bad", type: "cold" };
      if (temp >= 10 && temp <= 25) return { class: "Comfortable", comfort: "very good", type: "mild" };
      if (temp >= 26 && temp <= 35) return { class: "Hot", comfort: "bad", type: "warm" };
      if (temp > 35) return { class: "Very Hot", comfort: "very bad", type: "hot" };
      return { class: "Unknown", comfort: "normal", type: "unknown" };
    }

    // ÿØÿßŸÑÿ© ŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ±ÿ∑Ÿàÿ®ÿ©
    function classifyHumidity(humidity) {
      if (humidity < 30) return { class: "Dry", comfort: "bad", type: "dry" };
      if (humidity >= 30 && humidity <= 60) return { class: "Comfortable", comfort: "very good", type: "moderate" };
      if (humidity > 60) return { class: "Humid", comfort: "bad", type: "humid" };
      return { class: "Unknown", comfort: "normal", type: "unknown" };
    }

    // ÿØÿßŸÑÿ© ŸÑÿ™ÿµŸÜŸäŸÅ ÿ≥ÿ±ÿπÿ© ÿßŸÑÿ±Ÿäÿßÿ≠
    function classifyWindSpeed(windSpeed) {
      if (windSpeed < 10) return { class: "Calm", comfort: "very good", type: "calm" };
      if (windSpeed >= 10 && windSpeed <= 30) return { class: "Moderate", comfort: "good", type: "moderate" };
      if (windSpeed > 30) return { class: "Strong", comfort: "bad", type: "windy" };
      return { class: "Unknown", comfort: "normal", type: "unknown" };
    }

    // ÿØÿßŸÑÿ© ŸÑÿ™ÿµŸÜŸäŸÅ Ÿáÿ∑ŸàŸÑ ÿßŸÑÿ£ŸÖÿ∑ÿßÿ±
    function classifyPrecipitation(precip) {
      if (precip < 1) return { class: "No/Light Rain", comfort: "very good", type: "dry" };
      if (precip >= 1 && precip <= 5) return { class: "Moderate Rain", comfort: "normal", type: "rainy" };
      if (precip > 5) return { class: "Heavy Rain", comfort: "bad", type: "stormy" };
      return { class: "Unknown", comfort: "normal", type: "unknown" };
    }

    // ÿØÿßŸÑÿ© ŸÑÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ∑ŸÇÿ≥ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ∏ÿ±ŸàŸÅ
    function determineWeatherType(tempAssessment, humidityAssessment, windAssessment, precipAssessment) {
      const types = [];
      
      // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ¥ŸÖÿ≥Ÿãÿß
      if (tempAssessment.type === "warm" || tempAssessment.type === "hot") {
        if (precipAssessment.type === "dry") {
          types.push("sunny");
        }
      }
      
      // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ∫ÿßÿ¶ŸÖŸãÿß
      if (humidityAssessment.type === "humid" && precipAssessment.type === "dry") {
        types.push("cloudy");
      }
      
      // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÖÿ∑ÿ±Ÿãÿß
      if (precipAssessment.type === "rainy") {
        types.push("rainy");
      }
      
      // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿ´ŸÑÿ¨ŸäŸãÿß
      if (tempAssessment.type === "cold" && precipAssessment.type === "rainy") {
        types.push("snowy");
      }
      
      // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿπÿßÿµŸÅŸãÿß
      if (windAssessment.type === "windy" || precipAssessment.type === "stormy") {
        types.push("stormy");
      }
      
      // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿπÿßÿµŸÅŸãÿß
      if (windAssessment.type === "windy") {
        types.push("windy");
      }
      
      return types;
    }

    // ÿØÿßŸÑÿ© ŸÑÿ≠ÿ≥ÿßÿ® ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™
    function calculatePreferenceMatch(actualValue, userPreference, minValue, maxValue) {
      // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÅÿπŸÑŸäÿ© ÿ•ŸÑŸâ ŸÜÿ∑ÿßŸÇ 0-100
      const normalizedValue = ((actualValue - minValue) / (maxValue - minValue)) * 100;
      
      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÅÿ±ŸÇ ÿ®ŸäŸÜ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÅÿπŸÑŸäÿ© Ÿàÿ™ŸÅÿ∂ŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
      const difference = Math.abs(normalizedValue - userPreference);
      
      // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÅÿ±ŸÇ ÿ•ŸÑŸâ ŸÜÿ≥ÿ®ÿ© ÿ™ÿ∑ÿßÿ®ŸÇ (ŸÉŸÑŸÖÿß ŸÇŸÑ ÿßŸÑŸÅÿ±ŸÇ ÿ≤ÿßÿØÿ™ ÿßŸÑŸÜÿ≥ÿ®ÿ©)
      const matchPercentage = Math.max(0, 100 - difference);
      
      return matchPercentage;
    }

    // ÿØÿßŸÑÿ© ŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¥ÿßŸÖŸÑ ŸÖÿπ ŸÖÿ±ÿßÿπÿßÿ© ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™
    function calculateOverallRating(tempComfort, humidityComfort, windComfort, precipComfort, preferenceMatches) {
      const comfortScores = {
        "very bad": 1,
        "bad": 2,
        "normal": 3,
        "good": 4,
        "very good": 5
      };
      
      // ÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©
      const baseTempScore = comfortScores[tempComfort];
      const baseHumidityScore = comfortScores[humidityComfort];
      const baseWindScore = comfortScores[windComfort];
      const basePrecipScore = comfortScores[precipComfort];
      
      // ÿ™ÿ∑ÿ®ŸäŸÇ ÿ£Ÿàÿ≤ÿßŸÜ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™
      const totalImportance = userPreferences.temperature.importance + 
                             userPreferences.humidity.importance + 
                             userPreferences.wind.importance + 
                             userPreferences.precipitation.importance;
      
      const weightedTempScore = baseTempScore * (userPreferences.temperature.importance / totalImportance);
      const weightedHumidityScore = baseHumidityScore * (userPreferences.humidity.importance / totalImportance);
      const weightedWindScore = baseWindScore * (userPreferences.wind.importance / totalImportance);
      const weightedPrecipScore = basePrecipScore * (userPreferences.precipitation.importance / totalImportance);
      
      const totalWeightedScore = weightedTempScore + weightedHumidityScore + weightedWindScore + weightedPrecipScore;
      const maxWeightedScore = 5; // ÿ£ŸÇÿµŸâ ÿØÿ±ÿ¨ÿ© ŸÖŸÖŸÉŸÜÿ©
      
      // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿ•ŸÑŸâ ŸÜÿ∑ÿßŸÇ 1-5
      const adjustedScore = (totalWeightedScore / maxWeightedScore) * 5;
      
      // ÿ≠ÿ≥ÿßÿ® ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä
      const totalPreferenceMatch = (
        preferenceMatches.temperature + 
        preferenceMatches.humidity + 
        preferenceMatches.wind + 
        preferenceMatches.precipitation
      ) / 4;
      
      // ÿØŸÖÿ¨ ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿä ŸÖÿπ ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™
      const finalScore = (adjustedScore * 0.7) + (totalPreferenceMatch / 20 * 0.3); // 70% ŸÑŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿå 30% ŸÑÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™
      
      if (finalScore >= 4.5) return { rating: "Very Good", score: finalScore, class: "rating-very-good" };
      if (finalScore >= 3.5) return { rating: "Good", score: finalScore, class: "rating-good" };
      if (finalScore >= 2.5) return { rating: "Normal", score: finalScore, class: "rating-normal" };
      if (finalScore >= 1.5) return { rating: "Bad", score: finalScore, class: "rating-bad" };
      return { rating: "Very Bad", score: finalScore, class: "rating-very-bad" };
    }

    // ÿØÿßŸÑÿ© ŸÑÿπÿ±ÿ∂ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ∑ŸÇÿ≥
    function displayWeatherAssessment(result) {
      const temp = parseFloat(result.temperature);
      const humidity = parseFloat(result.humidity);
      const windSpeed = parseFloat(result.windSpeed);
      const precipitation = parseFloat(result.precipitation);
      
      // ÿ™ÿµŸÜŸäŸÅ ŸÉŸÑ ÿπŸÜÿµÿ±
      const tempAssessment = classifyTemperature(temp);
      const humidityAssessment = classifyHumidity(humidity);
      const windAssessment = classifyWindSpeed(windSpeed);
      const precipAssessment = classifyPrecipitation(precipitation);
      
      // ÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ∑ŸÇÿ≥
      const weatherTypes = determineWeatherType(tempAssessment, humidityAssessment, windAssessment, precipAssessment);
      
      // ÿ≠ÿ≥ÿßÿ® ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ŸÑŸÉŸÑ ÿπŸÜÿµÿ±
      const tempPreferenceMatch = calculatePreferenceMatch(temp, userPreferences.temperature.preference, -10, 45);
      const humidityPreferenceMatch = calculatePreferenceMatch(humidity, userPreferences.humidity.preference, 0, 100);
      const windPreferenceMatch = calculatePreferenceMatch(windSpeed, userPreferences.wind.preference, 0, 50);
      const precipPreferenceMatch = calculatePreferenceMatch(precipitation, userPreferences.precipitation.preference, 0, 20);
      
      const preferenceMatches = {
        temperature: tempPreferenceMatch,
        humidity: humidityPreferenceMatch,
        wind: windPreferenceMatch,
        precipitation: precipPreferenceMatch
      };
      
      // ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ¥ÿßŸÖŸÑ
      const overallRating = calculateOverallRating(
        tempAssessment.comfort, 
        humidityAssessment.comfort, 
        windAssessment.comfort, 
        precipAssessment.comfort,
        preferenceMatches
      );
      
      // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
      document.getElementById("overallRating").textContent = overallRating.rating;
      document.getElementById("ratingFill").className = "rating-fill " + overallRating.class;
      document.getElementById("ratingFill").style.width = (overallRating.score / 5 * 100) + "%";
      
      // ŸÜÿµ ÿßŸÑÿ™ŸàÿµŸäÿ©
      let recommendation = "";
      if (overallRating.rating === "Very Good") {
        recommendation = "Perfect weather conditions! Great for outdoor activities.";
      } else if (overallRating.rating === "Good") {
        recommendation = "Good weather conditions. Suitable for most outdoor activities.";
      } else if (overallRating.rating === "Normal") {
        recommendation = "Moderate weather conditions. Some activities may be affected.";
      } else if (overallRating.rating === "Bad") {
        recommendation = "Poor weather conditions. Consider indoor activities.";
      } else {
        recommendation = "Very poor weather conditions. Avoid outdoor activities if possible.";
      }
      
      // ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÑÿßÿ≠ÿ∏ÿ© ÿ≠ŸàŸÑ ÿ™ÿ∑ÿßÿ®ŸÇ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™
      const totalPreferenceMatch = (
        tempPreferenceMatch + humidityPreferenceMatch + windPreferenceMatch + precipPreferenceMatch
      ) / 4;
      
      document.getElementById("preferenceMatchValue").textContent = totalPreferenceMatch.toFixed(1) + "%";
      document.getElementById("weatherRecommendation").textContent = recommendation;
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
      document.getElementById("tempValue").textContent = temp.toFixed(1);
      document.getElementById("tempClass").textContent = tempAssessment.class;
      document.getElementById("tempComfort").textContent = tempAssessment.comfort;
      document.getElementById("tempPreferenceMatch").textContent = tempPreferenceMatch.toFixed(1) + "%";
      
      document.getElementById("humidityValue").textContent = humidity.toFixed(1);
      document.getElementById("humidityClass").textContent = humidityAssessment.class;
      document.getElementById("humidityComfort").textContent = humidityAssessment.comfort;
      document.getElementById("humidityPreferenceMatch").textContent = humidityPreferenceMatch.toFixed(1) + "%";
      
      document.getElementById("windValue").textContent = windSpeed.toFixed(1);
      document.getElementById("windClass").textContent = windAssessment.class;
      document.getElementById("windComfort").textContent = windAssessment.comfort;
      document.getElementById("windPreferenceMatch").textContent = windPreferenceMatch.toFixed(1) + "%";
      
      document.getElementById("precipValue").textContent = precipitation.toFixed(1);
      document.getElementById("precipClass").textContent = precipAssessment.class;
      document.getElementById("precipComfort").textContent = precipAssessment.comfort;
      document.getElementById("precipPreferenceMatch").textContent = precipPreferenceMatch.toFixed(1) + "%";
      
      // ÿ•ÿ∏Ÿáÿßÿ± ŸÇÿ≥ŸÖ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
      document.getElementById("weatherAssessment").style.display = "block";
    }

    // ‚úÖ ÿßŸÑÿØÿßŸÑÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    async function showData(city) {
      const day = parseInt(document.getElementById("day").value);
      const month = parseInt(document.getElementById("month").value);
      const year = parseInt(document.getElementById("year").value);
      const predictionType = document.getElementById("predictionType").value;

      if (isNaN(day) || isNaN(month) || isNaN(year)) {
        alert("Please enter valid day, month, and year!");
        return;
      }

      try {
        // ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸÑŸÅÿßÿ™ JSON ŸÖŸàÿ¨ŸàÿØÿ©ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
        let json;
        try {
          const response = await fetch(city.file);
          json = await response.json();
        } catch (error) {
          console.warn(`File ${city.file} not found. Using sample data.`);
          // ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ© ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±
          json = {
            properties: {
              parameter: {
                T2M: {},
                QV2M: {},
                WS10M: {},
                WD10M: {},
                PRECTOTCORR: {}
              }
            }
          };
          
          // ŸÖŸÑÿ° ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©
          for (let y = 2000; y <= 2025; y++) {
            const key = `${y}${month.toString().padStart(2,"0")}${day.toString().padStart(2,"0")}`;
            json.properties.parameter.T2M[key] = 20 + Math.random() * 20; // 20-40 ÿØÿ±ÿ¨ÿ©
            json.properties.parameter.QV2M[key] = 30 + Math.random() * 50; // 30-80%
            json.properties.parameter.WS10M[key] = 5 + Math.random() * 15; // 5-20 m/s
            json.properties.parameter.WD10M[key] = Math.random() * 360; // 0-360 ÿØÿ±ÿ¨ÿ©
            json.properties.parameter.PRECTOTCORR[key] = Math.random() * 10; // 0-10 mm
          }
        }
        
        const data = json.properties.parameter;

        const formatDate = (y, m, d) => `${y}${m.toString().padStart(2,"0")}${d.toString().padStart(2,"0")}`;

        // ÿ™ÿ≠ÿØŸäÿØ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿßÿ±ŸäÿÆŸäÿ© ÿ£ŸÖ ÿ™ŸÜÿ®ÿ§Ÿäÿ©
        isHistoricalData = isBeforeCutoffDate(day, month, year);
        
        function getPastValues(dataset) {
          const values = [];
          for (let y = 2000; y <= 2025; y++) {
            const key = formatDate(y, month, day);
            if (dataset[key] !== undefined && dataset[key] !== -999) {
              values.push(dataset[key]);
            }
          }
          return values;
        }

        const pastTemp = getPastValues(data.T2M);
        const pastHumidity = getPastValues(data.QV2M);
        const pastWindSpeed = getPastValues(data.WS10M);
        const pastWindDir = getPastValues(data.WD10M);
        const pastPrecip = getPastValues(data.PRECTOTCORR);

        if (pastTemp.length === 0) {
          alert("No past data available for this date.");
          return;
        }

        // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿßÿ±ŸäÿÆŸäÿ©
        const tempStats = calculateStats(pastTemp);
        const humidityStats = calculateStats(pastHumidity);
        const windSpeedStats = calculateStats(pastWindSpeed);
        const windDirStats = calculateStats(pastWindDir);
        const precipStats = calculateStats(pastPrecip);

        let result = {};

        // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸÇÿ®ŸÑ 4/10/2025ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅÿπŸÑŸäÿ©
        if (isHistoricalData) {
          const key = formatDate(year, month, day);
          result = {
            city: city.name,
            date: `${day}/${month}/${year}`,
            temperature: data.T2M[key] !== undefined && data.T2M[key] !== -999 ? data.T2M[key].toFixed(2) : tempStats.mean.toFixed(2),
            humidity: data.QV2M[key] !== undefined && data.QV2M[key] !== -999 ? data.QV2M[key].toFixed(2) : humidityStats.mean.toFixed(2),
            windSpeed: data.WS10M[key] !== undefined && data.WS10M[key] !== -999 ? data.WS10M[key].toFixed(2) : windSpeedStats.mean.toFixed(2),
            windDirection: data.WD10M[key] !== undefined && data.WD10M[key] !== -999 ? data.WD10M[key].toFixed(0) : windDirStats.mean.toFixed(0),
            precipitation: data.PRECTOTCORR[key] !== undefined && data.PRECTOTCORR[key] !== -999 ? data.PRECTOTCORR[key].toFixed(2) : precipStats.mean.toFixed(2)
          };
        } else {
          // ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿ®ÿπÿØ 4/10/2025ÿå ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ™ŸÜÿ®ÿ§ ŸÖÿπ ÿ™ÿ∫Ÿäÿ± ÿπÿ¥Ÿàÿßÿ¶Ÿä
          result = {
            city: city.name,
            date: `${day}/${month}/${year}`,
            temperature: getRandomValue(tempStats.mean, tempStats.stdDev).toFixed(2),
            humidity: getRandomValue(humidityStats.mean, humidityStats.stdDev).toFixed(2),
            windSpeed: getRandomValue(windSpeedStats.mean, windSpeedStats.stdDev).toFixed(2),
            windDirection: getRandomValue(windDirStats.mean, windDirStats.stdDev).toFixed(0),
            precipitation: getRandomValue(precipStats.mean, precipStats.stdDev).toFixed(2)
          };
        }

        lastResult = result;

        const ctx = document.getElementById("chart").getContext("2d");
        if (chart) chart.destroy();

        let datasets = [];
        if (predictionType === "all") {
          datasets = [
            { label: "Temperature (¬∞C)", data: [parseFloat(result.temperature)], backgroundColor: "rgba(255,99,132,0.7)" },
            { label: "Humidity (g/kg)", data: [parseFloat(result.humidity)], backgroundColor: "rgba(75,192,192,0.7)" },
            { label: "Wind Speed (m/s)", data: [parseFloat(result.windSpeed)], backgroundColor: "rgba(54,162,235,0.7)" },
            { label: "Wind Direction (¬∞)", data: [parseFloat(result.windDirection)], backgroundColor: "rgba(255,206,86,0.7)" },
            { label: "Precipitation (mm/dd)", data: [parseFloat(result.precipitation)], backgroundColor: "rgba(153,102,255,0.7)" }
          ];
        } else {
          datasets = [
            { label: predictionType, data: [parseFloat(result[predictionType])], backgroundColor: "rgba(54,162,235,0.7)" }
          ];
        }

        chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: [`Prediction for ${result.date} in ${result.city}`],
            datasets: datasets
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: "top" },
              title: { display: true, text: "Weather Prediction" }
            },
            scales: { y: { beginAtZero: true } }
          }
        });

        // ÿπÿ±ÿ∂ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ∑ŸÇÿ≥
        displayWeatherAssessment(result);
      } catch (err) {
        console.error(err);
        alert("Failed to load JSON data.");
      }
    }

    //  ÿØÿßŸÑÿ© ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
    function downloadData(type) {
      if (!lastResult) {
        alert("No data to download! Please click on a city first.");
        return;
      }
      if (type === "json") {
        const blob = new Blob([JSON.stringify(lastResult, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "weather_prediction.json";
        a.click();
        URL.revokeObjectURL(url);
      } else if (type === "csv") {
        const headers = Object.keys(lastResult).join(",") + "\n";
        const values = Object.values(lastResult).join(",") + "\n";
        const blob = new Blob([headers + values], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "weather_prediction.csv";
        a.click();
        URL.revokeObjectURL(url);
      }
    }

    // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÅÿ∂ŸäŸÑÿßÿ™ ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
    window.addEventListener('DOMContentLoaded', function() {
      loadPreferences();
    });
  </script>
</body>
</html>